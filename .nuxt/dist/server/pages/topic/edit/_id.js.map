{"version":3,"file":"pages/topic/edit/_id.js","sources":["webpack:///./pages/topic/edit/_id.vue?9823","webpack:///_id.vue","webpack:///./pages/topic/edit/_id.vue?8702","webpack:///./pages/topic/edit/_id.vue","webpack:///./common/utils.js","webpack:///./components/TagInput.vue?914f","webpack:///./components/MarkdownHelp.vue?ba7d","webpack:///./components/TagInput.vue?a8be","webpack:///./components/TagInput.vue?8982","webpack:///TagInput.vue","webpack:///./components/TagInput.vue?b687","webpack:///./components/TagInput.vue","webpack:///./components/MarkdownHelp.vue?3988","webpack:///./components/MarkdownHelp.vue?d9f5","webpack:///MarkdownHelp.vue","webpack:///./components/MarkdownHelp.vue?0bf1","webpack:///./components/MarkdownHelp.vue","webpack:///./components/MarkdownEditor.vue?7b0d","webpack:///MarkdownEditor.vue","webpack:///./components/MarkdownEditor.vue?a0a9","webpack:///./components/MarkdownEditor.vue"],"sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('section',{staticClass:\"main\"},[_vm._ssrNode(\"<div class=\\\"container main-container is-white left-main\\\" data-v-36eaa7f6>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"left-container\\\" data-v-36eaa7f6>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"widget\\\" data-v-36eaa7f6>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"widget-header\\\" data-v-36eaa7f6><nav class=\\\"breadcrumb\\\" data-v-36eaa7f6><ul data-v-36eaa7f6><li data-v-36eaa7f6><a href=\\\"/\\\" data-v-36eaa7f6>首页</a></li> <li data-v-36eaa7f6><a\"+(_vm._ssrAttr(\"href\",'/user/' + _vm.currentUser.id + '?tab=topics'))+\" data-v-36eaa7f6>\"+_vm._ssrEscape(_vm._s(_vm.currentUser.nickname))+\"</a></li> <li class=\\\"is-active\\\" data-v-36eaa7f6><a href=\\\"#\\\" aria-current=\\\"page\\\" data-v-36eaa7f6>主题</a></li></ul></nav></div> \"),_vm._ssrNode(\"<div class=\\\"widget-content\\\" data-v-36eaa7f6>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"field is-horizontal\\\" data-v-36eaa7f6>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"field-body\\\" data-v-36eaa7f6>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"field\\\" style=\\\"width:100%;\\\" data-v-36eaa7f6><input type=\\\"text\\\" placeholder=\\\"请输入标题\\\"\"+(_vm._ssrAttr(\"value\",(_vm.postForm.title)))+\" class=\\\"input\\\" data-v-36eaa7f6></div> \"),_vm._ssrNode(\"<div class=\\\"field\\\" data-v-36eaa7f6>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"select\\\" data-v-36eaa7f6>\",\"</div>\",[_c('select',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.postForm.nodeId),expression:\"postForm.nodeId\"}],on:{\"change\":function($event){var $$selectedVal = Array.prototype.filter.call($event.target.options,function(o){return o.selected}).map(function(o){var val = \"_value\" in o ? o._value : o.value;return val}); _vm.$set(_vm.postForm, \"nodeId\", $event.target.multiple ? $$selectedVal : $$selectedVal[0])}}},[_c('option',{attrs:{\"value\":\"0\"}},[_vm._v(\"选择节点\")]),_vm._v(\" \"),_vm._l((_vm.nodes),function(node){return _c('option',{key:node.nodeId,domProps:{\"value\":node.nodeId}},[_vm._v(_vm._s(node.name))])})],2)])])],2)]),_vm._ssrNode(\" \"),_vm._ssrNode(\"<div class=\\\"field\\\" data-v-36eaa7f6>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"control\\\" data-v-36eaa7f6>\",\"</div>\",[_c('markdown-editor',{attrs:{\"editor-id\":\"topicEditEditor\",\"placeholder\":\"可空，将图片复制或拖入编辑器可上传\"},model:{value:(_vm.postForm.content),callback:function ($$v) {_vm.$set(_vm.postForm, \"content\", $$v)},expression:\"postForm.content\"}})],1)]),_vm._ssrNode(\" \"),_vm._ssrNode(\"<div class=\\\"field\\\" data-v-36eaa7f6>\",\"</div>\",[_vm._ssrNode(\"<div class=\\\"control\\\" data-v-36eaa7f6>\",\"</div>\",[_c('tag-input',{model:{value:(_vm.postForm.tags),callback:function ($$v) {_vm.$set(_vm.postForm, \"tags\", $$v)},expression:\"postForm.tags\"}})],1)]),_vm._ssrNode(\" <div class=\\\"field is-grouped\\\" data-v-36eaa7f6><div class=\\\"control\\\" data-v-36eaa7f6><a\"+(_vm._ssrAttr(\"disabled\",_vm.publishing))+(_vm._ssrClass(\"button is-success\",{ 'is-loading': _vm.publishing }))+\" data-v-36eaa7f6>提交更改</a></div></div>\")],2)],2)]),_vm._ssrNode(\" \"),_vm._ssrNode(\"<div class=\\\"right-container\\\" data-v-36eaa7f6>\",\"</div>\",[_c('markdown-help')],1)],2)])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <section class=\"main\">\n    <div class=\"container main-container is-white left-main\">\n      <div class=\"left-container\">\n        <div class=\"widget\">\n          <div class=\"widget-header\">\n            <nav class=\"breadcrumb\">\n              <ul>\n                <li><a href=\"/\">首页</a></li>\n                <li>\n                  <a :href=\"'/user/' + currentUser.id + '?tab=topics'\">{{\n                    currentUser.nickname\n                  }}</a>\n                </li>\n                <li class=\"is-active\">\n                  <a href=\"#\" aria-current=\"page\">主题</a>\n                </li>\n              </ul>\n            </nav>\n          </div>\n          <div class=\"widget-content\">\n            <div class=\"field is-horizontal\">\n              <div class=\"field-body\">\n                <div class=\"field\" style=\"width:100%;\">\n                  <input\n                    v-model=\"postForm.title\"\n                    class=\"input\"\n                    type=\"text\"\n                    placeholder=\"请输入标题\"\n                  />\n                </div>\n                <div class=\"field\">\n                  <div class=\"select\">\n                    <select v-model=\"postForm.nodeId\">\n                      <option value=\"0\">选择节点</option>\n                      <option\n                        v-for=\"node in nodes\"\n                        :key=\"node.nodeId\"\n                        :value=\"node.nodeId\"\n                        >{{ node.name }}</option\n                      >\n                    </select>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div class=\"field\">\n              <div class=\"control\">\n                <markdown-editor\n                  v-model=\"postForm.content\"\n                  editor-id=\"topicEditEditor\"\n                  placeholder=\"可空，将图片复制或拖入编辑器可上传\"\n                />\n              </div>\n            </div>\n\n            <div class=\"field\">\n              <div class=\"control\">\n                <tag-input v-model=\"postForm.tags\" />\n              </div>\n            </div>\n\n            <div class=\"field is-grouped\">\n              <div class=\"control\">\n                <a\n                  :class=\"{ 'is-loading': publishing }\"\n                  :disabled=\"publishing\"\n                  @click=\"submitCreate\"\n                  class=\"button is-success\"\n                  >提交更改</a\n                >\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class=\"right-container\">\n        <markdown-help />\n      </div>\n    </div>\n  </section>\n</template>\n\n<script>\nimport utils from '~/common/utils'\nimport TagInput from '~/components/TagInput'\nimport MarkdownHelp from '~/components/MarkdownHelp'\nimport MarkdownEditor from '~/components/MarkdownEditor'\n\nexport default {\n  middleware: 'authenticated',\n  components: {\n    TagInput,\n    MarkdownHelp,\n    MarkdownEditor\n  },\n  async asyncData({ $axios, params }) {\n    const [topic, nodes] = await Promise.all([\n      $axios.get('/api/topic/edit/' + params.id),\n      $axios.get('/api/topic/nodes')\n    ])\n    return {\n      topic,\n      nodes,\n      postForm: {\n        nodeId: topic.nodeId,\n        title: topic.title,\n        tags: topic.tags,\n        content: topic.content\n      }\n    }\n  },\n  data() {\n    return {\n      publishing: false, // 当前是否正处于发布中...\n      postForm: {\n        nodeId: 0,\n        title: '',\n        tags: [],\n        content: ''\n      }\n    }\n  },\n  computed: {\n    currentUser() {\n      return this.$store.state.user.current\n    }\n  },\n  mounted() {},\n  methods: {\n    async submitCreate() {\n      const me = this\n      if (me.publishing) {\n        return\n      }\n      me.publishing = true\n\n      try {\n        const topic = await this.$axios.post(\n          '/api/topic/edit/' + this.topic.topicId,\n          {\n            nodeId: this.postForm.nodeId,\n            title: this.postForm.title,\n            content: this.postForm.content,\n            tags: this.postForm.tags ? this.postForm.tags.join(',') : ''\n          }\n        )\n        this.$toast.success('提交成功', {\n          duration: 1000,\n          onComplete() {\n            utils.linkTo('/topic/' + topic.topicId)\n          }\n        })\n      } catch (e) {\n        console.error(e)\n        me.publishing = false\n        this.$toast.error('提交失败：' + (e.message || e))\n      }\n    }\n  },\n  head() {\n    return {\n      title: this.$siteTitle('修改话题')\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped></style>\n","import mod from \"-!../../../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./_id.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./_id.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./_id.vue?vue&type=template&id=36eaa7f6&scoped=true&\"\nimport script from \"./_id.vue?vue&type=script&lang=js&\"\nexport * from \"./_id.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  \n}\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/_vue-loader@15.9.3@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"36eaa7f6\",\n  \"7a7ec3c4\"\n  \n)\n\nexport default component.exports","import Cookies from 'js-cookie'\nclass Utils {\n  getCity() {\n    // Cookies.get('city')\n    const city = Cookies.get('city')\n    if (city !== undefined) {\n      return city\n    }\n    return '北京'\n  }\n\n  setCity(city) {\n    return Cookies.set('city', city)\n  }\n\n  linkTo(path) {\n    window.location = path\n    // 这里使用$router.push会导致跳转页面之后window.vditor对象undefined，原因未知\n    // window.$nuxt.$router.push(path)\n  }\n\n  toSignin(ref) {\n    if (!ref && process.client) {\n      // 如果没配置refUrl，那么取当前地址\n      ref = window.location.pathname\n    }\n    this.linkTo('/user/signin?ref=' + encodeURIComponent(ref))\n  }\n\n  isSigninUrl(ref) {\n    return ref === '/user/signin'\n  }\n\n  isArray(sources) {\n    return Object.prototype.toString.call(sources) === '[object Array]'\n  }\n\n  isDate(sources) {\n    return (\n      {}.toString.call(sources) === '[object Date]' &&\n      sources.toString() !== 'Invalid Date' &&\n      !isNaN(sources)\n    )\n  }\n\n  isElement(sources) {\n    return !!(sources && sources.nodeName && sources.nodeType === 1)\n  }\n\n  isFunction(sources) {\n    return Object.prototype.toString.call(sources) === '[object Function]'\n  }\n\n  unique(arr) {\n    return arr.filter((item, index, arr) => {\n      return arr.indexOf(item, 0) === index\n    })\n  }\n\n  isNumber(sources) {\n    return (\n      Object.prototype.toString.call(sources) === '[object Number]' &&\n      isFinite(sources)\n    )\n  }\n\n  isObject(sources) {\n    return Object.prototype.toString.call(sources) === '[object Object]'\n  }\n\n  isString(sources) {\n    return Object.prototype.toString.call(sources) === '[object String]'\n  }\n\n  isBoolean(sources) {\n    return typeof sources === 'boolean'\n  }\n\n  getCityList() {\n    return ['北京', '上海', '深圳', '武汉', '杭州']\n  }\n\n  isEmpty(content) {\n    const str = content\n    if (str === '' || str === undefined) return true\n    const regu = '^[ ]+$'\n    const re = new RegExp(regu)\n    return re.test(str)\n  }\n\n  getTopText(topType) {\n    if (topType === 1) {\n      return '顶'\n    }\n\n    if (topType === 2) {\n      return '火'\n    }\n\n    if (topType === 3) {\n      return '精华'\n    }\n    return ''\n  }\n\n  formatDate(timestamp, fmt) {\n    fmt = fmt || 'yyyy-MM-dd HH:mm:ss'\n    const date = new Date(timestamp)\n    const o = {\n      'M+': date.getMonth() + 1,\n      'd+': date.getDate(),\n      'h+': date.getHours() % 12,\n      'H+': date.getHours(),\n      'm+': date.getMinutes(),\n      's+': date.getSeconds(),\n      'q+': Math.floor((date.getMonth() + 3) / 3),\n      S: date.getMilliseconds()\n    }\n    if (/(y+)/.test(fmt)) {\n      fmt = fmt.replace(\n        RegExp.$1,\n        (date.getFullYear() + '').substr(4 - RegExp.$1.length)\n      )\n    }\n    for (const k in o) {\n      if (new RegExp('(' + k + ')').test(fmt)) {\n        fmt = fmt.replace(\n          RegExp.$1,\n          RegExp.$1.length === 1\n            ? o[k]\n            : ('00' + o[k]).substr(('' + o[k]).length)\n        )\n      }\n    }\n    return fmt\n  }\n\n  prettyDate(timestamp) {\n    const minute = 1000 * 60\n    const hour = minute * 60\n    const day = hour * 24\n    const diffValue = new Date().getTime() - timestamp\n    if (diffValue / minute < 1) {\n      return '刚刚'\n    } else if (diffValue / minute < 60) {\n      return parseInt(diffValue / minute) + '分钟前'\n    } else if (diffValue / hour <= 24) {\n      return parseInt(diffValue / hour) + '小时前'\n    } else if (diffValue / day <= 30) {\n      return parseInt(diffValue / day) + '天前'\n    }\n    return Utils.formatDate(timestamp, 'yyyy-MM-dd HH:mm:ss')\n  }\n}\nexport default new Utils()\n","// Exports\nmodule.exports = {};\n","// Exports\nmodule.exports = {};\n","import mod from \"-!../node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js??ref--7-oneOf-1-0!../node_modules/_vue-loader@15.9.3@vue-loader/lib/loaders/stylePostLoader.js!../node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js??ref--7-oneOf-1-1!../node_modules/_sass-loader@7.3.1@sass-loader/dist/cjs.js??ref--7-oneOf-1-2!../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./TagInput.vue?vue&type=style&index=0&id=6dde72f9&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js??ref--7-oneOf-1-0!../node_modules/_vue-loader@15.9.3@vue-loader/lib/loaders/stylePostLoader.js!../node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js??ref--7-oneOf-1-1!../node_modules/_sass-loader@7.3.1@sass-loader/dist/cjs.js??ref--7-oneOf-1-2!../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./TagInput.vue?vue&type=style&index=0&id=6dde72f9&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"select-tags\"},[_vm._ssrNode(\"<input id=\\\"tags\\\" name=\\\"tags\\\" type=\\\"hidden\\\"\"+(_vm._ssrAttr(\"value\",(_vm.tags)))+\" data-v-6dde72f9> <div class=\\\"tags-selected\\\" data-v-6dde72f9>\"+(_vm._ssrList((_vm.tags),function(tag){return (\"<span class=\\\"tag-item\\\" data-v-6dde72f9><span class=\\\"text\\\" data-v-6dde72f9>\"+_vm._ssrEscape(_vm._s(tag))+\"<i\"+(_vm._ssrAttr(\"data-name\",tag))+\" class=\\\"iconfont icon-close\\\" data-v-6dde72f9></i></span></span>\")}))+\"</div> <input\"+(_vm._ssrAttr(\"placeholder\",'标签（用逗号分隔，最多' + _vm.maxTagCount + '个）'))+\" type=\\\"text\\\"\"+(_vm._ssrAttr(\"value\",(_vm.inputTag)))+\" class=\\\"input\\\" data-v-6dde72f9> \"+((_vm.autocompleteTags.length > 0)?(\"<div class=\\\"autocomplete-tags\\\" data-v-6dde72f9><div class=\\\"tags-container\\\" data-v-6dde72f9><section class=\\\"tag-section\\\" data-v-6dde72f9>\"+(_vm._ssrList((_vm.autocompleteTags),function(item,index){return (\"<div\"+(_vm._ssrClass(\"tag-item\",{ active: index === _vm.selectIndex }))+\" data-v-6dde72f9>\"+_vm._ssrEscape(_vm._s(item))+\"</div>\")}))+\"</section></div></div>\"):\"<!---->\")+\" \"+((_vm.showRecommendTags)?(\"<div class=\\\"recommend-tags\\\" data-v-6dde72f9><div class=\\\"tags-container\\\" data-v-6dde72f9><div class=\\\"header\\\" data-v-6dde72f9><span data-v-6dde72f9>推荐标签</span> <span class=\\\"close-recommend\\\" data-v-6dde72f9><i class=\\\"iconfont icon-close\\\" data-v-6dde72f9></i></span></div> \"+(_vm._ssrList((_vm.recommendTags),function(tag){return (\"<a class=\\\"tag-item\\\" data-v-6dde72f9>\"+_vm._ssrEscape(_vm._s(tag))+\"</a>\")}))+\"</div></div>\"):\"<!---->\"))])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"select-tags\">\n    <input id=\"tags\" v-model=\"tags\" name=\"tags\" type=\"hidden\" />\n    <div class=\"tags-selected\">\n      <span v-for=\"tag in tags\" :key=\"tag\" class=\"tag-item\">\n        <span class=\"text\"\n          >{{ tag\n          }}<i\n            :data-name=\"tag\"\n            class=\"iconfont icon-close\"\n            @click=\"clickRemoveTag\"\n        /></span>\n      </span>\n    </div>\n    <input\n      ref=\"tagInput\"\n      v-model=\"inputTag\"\n      :placeholder=\"'标签（用逗号分隔，最多' + maxTagCount + '个）'\"\n      class=\"input\"\n      type=\"text\"\n      @input=\"autocomplete\"\n      @keydown.delete=\"removeTag\"\n      @keydown.enter=\"addTag\"\n      @keydown.32=\"addTag\"\n      @keydown.186=\"addTag\"\n      @keydown.188=\"addTag\"\n      @keydown.38=\"selectUp\"\n      @keydown.40=\"selectDown\"\n      @keydown.esc=\"close\"\n      @focus=\"openRecommendTags\"\n      @blur=\"closeRecommendTags\"\n      @click=\"openRecommendTags\"\n    />\n    <div v-if=\"autocompleteTags.length > 0\" class=\"autocomplete-tags\">\n      <div class=\"tags-container\">\n        <section class=\"tag-section\">\n          <div\n            v-for=\"(item, index) in autocompleteTags\"\n            :key=\"item\"\n            :class=\"{ active: index === selectIndex }\"\n            class=\"tag-item\"\n            @click=\"selectTag(index)\"\n            v-text=\"item\"\n          />\n        </section>\n      </div>\n    </div>\n    <div v-if=\"showRecommendTags\" class=\"recommend-tags\">\n      <div class=\"tags-container\">\n        <div class=\"header\">\n          <span>推荐标签</span>\n          <span class=\"close-recommend\"\n            ><i class=\"iconfont icon-close\" @click=\"closeRecommendTags\"\n          /></span>\n        </div>\n        <a\n          v-for=\"tag in recommendTags\"\n          :key=\"tag\"\n          class=\"tag-item\"\n          @click=\"addRecommendTag(tag)\"\n          v-text=\"tag\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    value: {\n      type: Array,\n      default() {\n        return []\n      }\n    },\n    suggestTags: {\n      type: Array,\n      default() {\n        return []\n      }\n    }\n  },\n  data() {\n    return {\n      tags: this.value || [],\n      maxTagCount: 3, // 最多可以选择的标签数量\n      maxWordCount: 5, // 每个标签最大字数\n      showRecommendTags: false, // 是否显示推荐\n      inputTag: '',\n      autocompleteTags: [],\n      selectIndex: -1\n    }\n  },\n  computed: {\n    // 推荐标签\n    recommendTags() {\n      return this.suggestTags\n      // return this.$store.state.config.config.recommendTags\n    }\n  },\n  methods: {\n    removeTag(event, tag) {\n      const selectionStart = this.$refs.tagInput.selectionStart\n      if (!this.inputTag || selectionStart === 0) {\n        // input框没内容，或者光标在首位的时候就删除最后一个标签\n        this.tags.splice(this.tags.length - 1, 1)\n        this.$emit('input', this.tags)\n      }\n    },\n\n    clickRemoveTag(event) {\n      const tag = event.target.dataset.name\n      if (tag) {\n        const index = this.tags.indexOf(tag)\n        if (index !== -1) {\n          this.tags.splice(index, 1)\n          this.$emit('input', this.tags)\n        }\n      }\n    },\n\n    /**\n     * 手动点击选择标签\n     * @param index\n     */\n    selectTag(index) {\n      this.selectIndex = index\n      this.addTag()\n    },\n\n    /**\n     * 添加标签\n     * @param event\n     */\n    addTag(event) {\n      if (event) {\n        event.stopPropagation()\n        event.preventDefault()\n      }\n\n      if (\n        this.selectIndex >= 0 &&\n        this.autocompleteTags.length > this.selectIndex\n      ) {\n        this.addTagName(this.autocompleteTags[this.selectIndex])\n      } else {\n        this.addTagName(this.inputTag)\n      }\n      this.autocompleteTags = []\n      this.selectIndex = -1\n    },\n\n    /**\n     * 添加推荐标签\n     * @param tagName\n     */\n    addRecommendTag(tagName) {\n      this.addTagName(tagName)\n      this.closeRecommendTags()\n    },\n\n    /**\n     * 添加标签\n     * @param tagName 标签名称\n     * @returns {boolean} 是否成功\n     */\n    addTagName(tagName) {\n      if (!tagName) {\n        return false\n      }\n\n      // 最多四个标签\n      if (this.tags && this.tags.length >= this.maxTagCount) {\n        return false\n      }\n\n      // 每个标签最多15个字符\n      if (tagName.length > this.maxWordCount) {\n        return false\n      }\n\n      // 标签已经存在\n      if (this.tags && this.tags.includes(tagName)) {\n        return false\n      }\n\n      this.tags.push(tagName)\n      this.inputTag = ''\n      this.$emit('input', this.tags)\n      return true\n    },\n\n    async autocomplete() {\n      this.closeRecommendTags()\n      this.selectIndex = -1\n      if (!this.inputTag) {\n        this.autocompleteTags = []\n      } else {\n        const ret = await this.$axios.post('/api/tag/autocomplete', {\n          input: this.inputTag\n        })\n        this.autocompleteTags = []\n        if (ret.length > 0) {\n          for (let i = 0; i < ret.length; i++) {\n            this.autocompleteTags.push(ret[i].name)\n          }\n        }\n      }\n    },\n\n    selectUp(event) {\n      event.stopPropagation()\n      event.preventDefault()\n      const curIndex = this.selectIndex\n      const maxIndex = this.autocompleteTags.length - 1\n      if (maxIndex < 0 || curIndex < 0) {\n        // 已经在最顶部\n        return\n      }\n      this.selectIndex--\n    },\n\n    selectDown(event) {\n      event.stopPropagation()\n      event.preventDefault()\n      const curIndex = this.selectIndex\n      const maxIndex = this.autocompleteTags.length - 1\n      if (maxIndex < 0 || curIndex >= maxIndex) {\n        // 已经在最底部\n        return\n      }\n      this.selectIndex++\n    },\n\n    // 关闭推荐\n    openRecommendTags() {\n      this.showRecommendTags = true\n    },\n\n    // 开启推荐\n    closeRecommendTags() {\n      setTimeout(() => {\n        this.showRecommendTags = false\n      }, 300)\n    },\n\n    // 关闭自动补全\n    close() {\n      if (this.autocompleteTags && this.autocompleteTags.length > 0) {\n        this.autocompleteTags = []\n        this.selectIndex = -1\n      }\n      this.closeRecommendTags()\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.select-tags {\n  display: flex;\n  background-color: #fff;\n  border: 1px solid #dbdbdb;\n  //border-radius: 4px;\n  //box-shadow: inset 0 1px 2px rgba(10, 10, 10, .1);\n  color: #363636;\n  padding: 0 8px;\n\n  .input {\n    border: none;\n    box-shadow: none;\n    margin: 0;\n    padding: 0;\n  }\n\n  .tags-selected {\n    display: flex;\n\n    span.tag-item {\n      margin: 5px 5px 5px 0;\n      padding: 0 5px;\n      background: #eee;\n      color: #000;\n\n      .text {\n        text-align: center;\n        vertical-align: middle;\n        font-size: 12px;\n        color: rgba(0, 0, 0, 0.38);\n        white-space: nowrap;\n        display: inline-block;\n\n        i {\n          font-size: 12px;\n          margin-left: 4px;\n        }\n\n        i:hover {\n          color: red;\n          cursor: pointer;\n        }\n      }\n    }\n  }\n\n  .autocomplete-tags {\n    z-index: 2000;\n    left: 0;\n    right: 0;\n    top: 38px;\n    bottom: 0;\n    position: absolute;\n\n    .tags-container {\n      scroll-behavior: smooth;\n      position: relative;\n      background: #f7f7f7;\n      border-left: 1px solid #dbdbdb;\n      border-right: 1px solid #dbdbdb;\n      border-bottom: 1px solid #dbdbdb;\n\n      .tag-section {\n        font-size: 14px;\n        line-height: 16px;\n\n        .tag-item {\n          padding: 8px 15px;\n          cursor: pointer;\n\n          &.active,\n          &:hover {\n            color: #fff;\n            background: #006bde;\n          }\n        }\n      }\n    }\n  }\n\n  .recommend-tags {\n    z-index: 2000;\n    left: 0;\n    right: 0;\n    top: 38px;\n    bottom: 0;\n    position: absolute;\n\n    .tags-container {\n      scroll-behavior: smooth;\n      position: relative;\n      background: #f7f7f7;\n      border-left: 1px solid #dbdbdb;\n      border-right: 1px solid #dbdbdb;\n      border-bottom: 1px solid #dbdbdb;\n      padding: 0 10px 10px 10px;\n\n      .header {\n        font-weight: bold;\n        font-size: 15px;\n        color: #017e66;\n        border-bottom: 1px solid #dbdbdb;\n        margin-bottom: 5px;\n        padding-top: 5px;\n        padding-bottom: 5px;\n\n        .close-recommend {\n          float: right;\n          cursor: pointer;\n          &:hover {\n            color: red;\n          }\n        }\n      }\n\n      .tag-item {\n        padding: 0 11px;\n        border-radius: 11px;\n        display: inline-block;\n        color: #017e66;\n        background-color: rgba(1, 126, 102, 0.08);\n        height: 22px;\n        line-height: 22px;\n        font-weight: normal;\n        font-size: 13px;\n        text-align: center;\n\n        &:not(:last-child) {\n          margin-right: 5px;\n        }\n\n        img {\n          width: 16px;\n          height: 16px;\n          margin-right: 5px;\n          margin-top: -1px;\n          vertical-align: middle;\n        }\n      }\n\n      .tag-item:hover,\n      .tag-item:focus {\n        background-color: #017e66;\n        color: #fff;\n        text-decoration: none;\n      }\n    }\n  }\n}\n</style>\n","import mod from \"-!../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./TagInput.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./TagInput.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TagInput.vue?vue&type=template&id=6dde72f9&scoped=true&\"\nimport script from \"./TagInput.vue?vue&type=script&lang=js&\"\nexport * from \"./TagInput.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  var style0 = require(\"./TagInput.vue?vue&type=style&index=0&id=6dde72f9&lang=scss&scoped=true&\")\nif (style0.__inject__) style0.__inject__(context)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../node_modules/_vue-loader@15.9.3@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"6dde72f9\",\n  \"d9b14516\"\n  \n)\n\nexport default component.exports","import mod from \"-!../node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js??ref--7-oneOf-1-0!../node_modules/_vue-loader@15.9.3@vue-loader/lib/loaders/stylePostLoader.js!../node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js??ref--7-oneOf-1-1!../node_modules/_sass-loader@7.3.1@sass-loader/dist/cjs.js??ref--7-oneOf-1-2!../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./MarkdownHelp.vue?vue&type=style&index=0&id=29e12336&lang=scss&scoped=true&\"; export default mod; export * from \"-!../node_modules/_css-loader@3.6.0@css-loader/dist/cjs.js??ref--7-oneOf-1-0!../node_modules/_vue-loader@15.9.3@vue-loader/lib/loaders/stylePostLoader.js!../node_modules/_postcss-loader@3.0.0@postcss-loader/src/index.js??ref--7-oneOf-1-1!../node_modules/_sass-loader@7.3.1@sass-loader/dist/cjs.js??ref--7-oneOf-1-2!../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./MarkdownHelp.vue?vue&type=style&index=0&id=29e12336&lang=scss&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"widget markdown-help\"},[_vm._ssrNode(\"<div class=\\\"widget-header\\\" data-v-29e12336>\\n    Markdown 语法参考\\n  </div> <div class=\\\"widget-content content\\\" data-v-29e12336><ol data-v-29e12336><li data-v-29e12336><span style=\\\"font-weight: 700; color: red;\\\" data-v-29e12336>将图片复制或拖入编辑器可上传</span></li> <li data-v-29e12336>## 单行的标题</li> <li data-v-29e12336>**粗体**</li> <li data-v-29e12336>`console.log('行内代码')`</li> <li data-v-29e12336>```js\\\\n code \\\\n``` 标记代码块</li> <li data-v-29e12336>[内容](链接)</li> <li data-v-29e12336>![文字说明](图片链接)</li></ol> <span data-v-29e12336><a href=\\\"https://mlog.club/article/5522\\\" target=\\\"_blank\\\" data-v-29e12336>Markdown 文档</a></span></div>\")])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"widget markdown-help\">\n    <div class=\"widget-header\">\n      Markdown 语法参考\n    </div>\n    <div class=\"widget-content content\">\n      <ol>\n        <li>\n          <span style=\"font-weight: 700; color: red;\"\n            >将图片复制或拖入编辑器可上传</span\n          >\n        </li>\n        <li>## 单行的标题</li>\n        <li>**粗体**</li>\n        <li>`console.log('行内代码')`</li>\n        <li>```js\\n code \\n``` 标记代码块</li>\n        <li>[内容](链接)</li>\n        <li>![文字说明](图片链接)</li>\n      </ol>\n      <span>\n        <a href=\"https://mlog.club/article/5522\" target=\"_blank\"\n          >Markdown 文档</a\n        >\n      </span>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {}\n</script>\n\n<style lang=\"scss\" scoped>\n.markdown-help {\n  .content {\n    font-size: 12px !important;\n  }\n}\n</style>\n","import mod from \"-!../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./MarkdownHelp.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./MarkdownHelp.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MarkdownHelp.vue?vue&type=template&id=29e12336&scoped=true&\"\nimport script from \"./MarkdownHelp.vue?vue&type=script&lang=js&\"\nexport * from \"./MarkdownHelp.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  var style0 = require(\"./MarkdownHelp.vue?vue&type=style&index=0&id=29e12336&lang=scss&scoped=true&\")\nif (style0.__inject__) style0.__inject__(context)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../node_modules/_vue-loader@15.9.3@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"29e12336\",\n  \"e8be3116\"\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"vditor\",style:({ width: _vm.width, height: _vm.height }),attrs:{\"id\":_vm.editorId}},[])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div\n    :id=\"editorId\"\n    :style=\"{ width: width, height: height }\"\n    class=\"vditor\"\n  />\n</template>\n\n<script>\nexport default {\n  props: {\n    editorId: {\n      type: String,\n      default: 'vditor'\n    },\n    value: {\n      type: String,\n      default: ''\n    },\n    height: {\n      type: String,\n      default: '400px' // normal、mini\n    },\n    placeholder: {\n      type: String,\n      default: '请输入...'\n    }\n  },\n  data() {\n    return {\n      isLoading: true,\n      vditor: null,\n      width: '100%',\n      toolbar: [\n        // 'emoji',\n        'headings',\n        'bold',\n        'italic',\n        'strike',\n        '|',\n        'line',\n        'quote',\n        'list',\n        'ordered-list',\n        'check',\n        'code',\n        'inline-code',\n        'undo',\n        'redo',\n        'upload',\n        'link',\n        'table',\n        'wysiwyg',\n        'both',\n        'preview',\n        'format',\n        'fullscreen'\n      ]\n    }\n  },\n  mounted() {\n    this.doInit()\n    this.$nextTick(async () => {\n      if (this.vditor) {\n        await this.vditor.getHTML(true)\n        this.isLoading = false\n      }\n    })\n  },\n  methods: {\n    /**\n     * 初始化编辑器\n     */\n    doInit() {\n      if (!process.client) {\n        return\n      }\n      const me = this\n      const userToken = this.$cookies.get('userToken')\n      const options = {\n        width: me.width,\n        height: me.height,\n        toolbar: me.toolbar,\n        placeholder: me.placeholder,\n        cache: true,\n        counter: '999999',\n        delay: 500,\n        mode: 'markdown-show',\n        theme: 'classic',\n        customEmoji: {\n          '1': '😝'\n        },\n        preview: {\n          mode: 'editor',\n          hljs: {\n            enable: true,\n            style: 'github',\n            lineNumber: true\n          }\n        },\n        input(val) {\n          me.$emit('input', val)\n        },\n        ctrlEnter(val) {\n          me.$emit('input', val)\n          me.$emit('submit', val)\n        },\n        upload: {\n          accept: 'image/*',\n          url: '/api/upload/editor?userToken=' + userToken,\n          linkToImgUrl: '/api/upload/fetch?userToken=' + userToken,\n          filename(name) {\n            return name.replace(/\\?|\\\\|\\/|:|\\||<|>|\\*|\\[|\\]|\\s+/g, '-')\n          }\n        }\n      }\n      this.vditor = new window.Vditor(me.editorId, options)\n      this.vditor.setValue(this.value)\n    },\n    /**\n     * 清空编辑器内容\n     */\n    clear() {\n      if (this.vditor) {\n        this.value = ''\n        this.vditor.setValue('')\n        this.clearCache()\n      }\n    },\n    /**\n     * 清理缓存\n     */\n    clearCache() {\n      if (this.vditor) {\n        this.vditor.clearCache()\n      }\n    }\n  },\n  head() {\n    return {\n      link: [\n        {\n          rel: 'stylesheet',\n          href: '//cdn.jsdelivr.net/npm/vditor@2.1.0/dist/index.classic.css'\n        }\n      ],\n      script: [\n        {\n          src: '//cdn.jsdelivr.net/npm/vditor@2.1.0/dist/index.min.js'\n        }\n      ]\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped></style>\n","import mod from \"-!../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./MarkdownEditor.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/_babel-loader@8.1.0@babel-loader/lib/index.js??ref--2-0!../node_modules/_vue-loader@15.9.3@vue-loader/lib/index.js??vue-loader-options!./MarkdownEditor.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MarkdownEditor.vue?vue&type=template&id=6f3f59ba&scoped=true&\"\nimport script from \"./MarkdownEditor.vue?vue&type=script&lang=js&\"\nexport * from \"./MarkdownEditor.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  \n}\n\n/* normalize component */\nimport normalizer from \"!../node_modules/_vue-loader@15.9.3@vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"6f3f59ba\",\n  \"7f27a6be\"\n  \n)\n\nexport default component.exports"],"mappings":";;;;;;;;;;;AAAA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACmFA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAHA;AACA;AAIA;AAAA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAHA;AAUA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAJA;AAFA;AASA;AACA;AAAA;AACA;AACA;AACA;AACA;AAJA;AACA;AAIA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AAJA;AAOA;AACA;AACA;AAAA;AACA;AACA;AACA;AALA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AA9BA;AACA;AA8BA;AACA;AACA;AADA;AAGA;AACA;AA5EA;;AC1FA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACrBA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AACA;AASA;AACA;AAIA;AACA;AAAA;AACA;AACA;AAMA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAxJA;AACA;AAwJA;;;;;;;AC1JA;AACA;;;;;;;;ACDA;AACA;;;;;;;;;ACDA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;ACAA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACkEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AALA;AAMA;AACA;AACA;AAAA;AACA;AACA;AACA;AALA;AAPA;AACA;AAaA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAPA;AASA;AACA;AAAA;AACA;AACA;AACA;AAEA;AACA;AANA;AAOA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;;;;;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AA1JA;AAjCA;;ACpEA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACvBA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;ACAA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC2BA;;AC7BA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;ACvBA;AACA;AACA;;;;;;;;;;;;;ACOA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAHA;AAIA;AACA;AACA;AAFA;AAbA;AACA;AAiBA;AACA;AACA;AACA;AACA;AACA;AAEA;AANA;AA8BA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAHA;AAFA;AACA;AAOA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAPA;AA5BA;AAqCA;AACA;AACA;AACA;AAAA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AApEA;AACA;AAoEA;AACA;AACA;AAEA;AACA;AAFA;AAKA;AAEA;AADA;AARA;AAaA;AACA;AAhJA;;ACTA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}