(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{482:function(e,t,r){"use strict";r.r(t);r(69),r(24),r(16),r(40),r(15);var o=r(2),n=r(35);r(8);function l(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}var d={layout:"admin",data:function(){return{results:[],listLoading:!1,page:{},filters:{id:""},selectedRows:[],addForm:{username:"",nickname:"",avatar:"",email:"",roles:[],password:"",status:""},addFormVisible:!1,addFormRules:{},addLoading:!1,editForm:{id:"",username:"",nickname:"",avatar:"",email:"",roles:[],password:"",status:""},editFormVisible:!1,editFormRules:{},editLoading:!1,forbiddenForm:{userId:"",days:0,reason:""},forbiddenFormVisible:!1,forbiddenLoading:!1}},mounted:function(){this.list()},methods:{list:function(){var e=this;e.listLoading=!0;var t=Object.assign(e.filters,{page:e.page.page,limit:e.page.limit});this.$axios.post("/api/admin/user/list",t).then((function(data){e.results=data.results,e.page=data.page})).finally((function(){e.listLoading=!1}))},handlePageChange:function(e){this.page.page=e,this.list()},handleLimitChange:function(e){this.page.limit=e,this.list()},handleAdd:function(){this.addForm={name:"",description:""},this.addFormVisible=!0},addSubmit:function(){var e=this;this.$axios.post("/api/admin/user/create",this.addForm).then((function(data){e.$message({message:"提交成功",type:"success"}),e.addFormVisible=!1,e.list()})).catch((function(t){e.$notify.error({title:"错误",message:t.message})}))},handleEdit:function(e,t){var r=this;this.$axios.get("/api/admin/user/".concat(t.id)).then((function(data){r.editForm=Object.assign({},data),r.editForm.password="",r.editFormVisible=!0})).catch((function(e){r.$notify.error({title:"错误",message:e.message})}))},editSubmit:function(){var e=function(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(t){Object(n.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}({},this.editForm);e.roles&&e.roles.length?e.roles=e.roles.join(","):e.roles="";var t=this;this.$axios.post("/api/admin/user/update",e).then((function(data){t.list(),t.editFormVisible=!1})).catch((function(e){t.$notify.error({title:"错误",message:e.message})}))},handleSelectionChange:function(e){this.selectedRows=e},showForbiddenDialog:function(e,t){this.forbiddenForm={userId:t.id,days:7,reason:"广告"},this.forbiddenFormVisible=!0},forbidden:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.forbiddenLoading=!0,t.prev=1,t.next=4,e.$axios.post("/api/admin/user/forbidden",e.forbiddenForm);case 4:e.forbiddenForm={},e.forbiddenFormVisible=!1,e.$message.success("禁言成功"),e.list(),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),e.$message.success("禁言失败 "+(t.t0.message||t.t0));case 13:return t.prev=13,e.forbiddenLoading=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[1,10,13,16]])})))()},removeForbidden:function(e,t){var r=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.$axios.post("/api/admin/user/forbidden",{userId:t.id,days:0});case 3:r.$message.success("取消禁言成功"),r.list(),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),r.$message.success("取消禁言失败 "+(e.t0.message||e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()}}},c=r(49),component=Object(c.a)(d,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"page-container"},[r("div",{staticClass:"toolbar"},[r("el-form",{attrs:{inline:!0,model:e.filters}},[r("el-form-item",[r("el-input",{attrs:{placeholder:"编号"},model:{value:e.filters.id,callback:function(t){e.$set(e.filters,"id",t)},expression:"filters.id"}})],1),e._v(" "),r("el-form-item",[r("el-input",{attrs:{placeholder:"用户名"},model:{value:e.filters.username,callback:function(t){e.$set(e.filters,"username",t)},expression:"filters.username"}})],1),e._v(" "),r("el-form-item",[r("el-input",{attrs:{placeholder:"昵称"},model:{value:e.filters.nickname,callback:function(t){e.$set(e.filters,"nickname",t)},expression:"filters.nickname"}})],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.list}},[e._v("查询")])],1),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增")])],1)],1)],1),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.results,"highlight-current-row":"",stripe:""},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.forbidden?r("div",{staticStyle:{"font-weight":"600",color:"red"}},[r("span",[e._v("已禁言至")]),e._v(" "),-1===t.row.forbiddenEndTime?r("span",[e._v("永久")]):r("span",[e._v(e._s(e._f("formatDate")(t.row.forbiddenEndTime)))])]):e._e(),e._v(" "),t.row.roles&&t.row.roles.length?r("div",[r("div",[r("span",[e._v("角色：")]),e._v(" "),e._l(t.row.roles,(function(t){return r("el-tag",{key:t,staticStyle:{"margin-right":"3px"},attrs:{size:"mini"}},[e._v(e._s(t)+"\n            ")])}))],2)]):e._e(),e._v(" "),r("div",[r("span",[e._v("状态：")]),e._v("\n          "+e._s(0===t.row.status?"正常":"删除")+"\n        ")]),e._v(" "),r("div",[r("span",[e._v("注册时间：")]),e._v("\n          "+e._s(e._f("formatDate")(t.row.createTime))+"\n        ")]),e._v(" "),r("div",[r("span",[e._v("更新时间：")]),e._v("\n          "+e._s(e._f("formatDate")(t.row.updateTime))+"\n        ")])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"id",label:"编号",width:"100"}}),e._v(" "),r("el-table-column",{attrs:{prop:"avatar",label:"头像",width:"80"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("img",{staticStyle:{"max-height":"50px","max-width":"50px","border-radius":"50%"},attrs:{src:e.row.avatar}})]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"username",label:"用户名"}}),e._v(" "),r("el-table-column",{attrs:{prop:"nickname",label:"昵称"}}),e._v(" "),r("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),e._v(" "),r("el-table-column",{attrs:{prop:"score",label:"积分"}}),e._v(" "),r("el-table-column",{attrs:{prop:"forbidden",label:"是否禁言"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.forbidden?r("span",{staticClass:"tag is-warning"},[e._v("已禁言")]):r("span",{staticClass:"tag is-success"},[e._v("正常")])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"createTime",label:"注册时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("formatDate")(t.row.createTime)))]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-button",{attrs:{size:"small"},on:{click:function(r){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),t.row.forbidden?r("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(r){return e.removeForbidden(t.$index,t.row)}}},[e._v("取消禁言\n        ")]):r("el-button",{attrs:{size:"small",type:"warning"},on:{click:function(r){return e.showForbiddenDialog(t.$index,t.row)}}},[e._v("禁言")])]}}])})],1),e._v(" "),r("div",{staticClass:"pagebar"},[r("el-pagination",{attrs:{"page-sizes":[20,50,100,300],"current-page":e.page.page,"page-size":e.page.limit,total:e.page.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"current-change":e.handlePageChange,"size-change":e.handleLimitChange}})],1),e._v(" "),r("el-dialog",{attrs:{visible:e.addFormVisible,"close-on-click-modal":!1,title:"新增"},on:{"update:visible":function(t){e.addFormVisible=t}}},[r("el-form",{ref:"addForm",attrs:{model:e.addForm,rules:e.addFormRules,"label-width":"80px"}},[r("el-form-item",{attrs:{label:"用户名",prop:"username"}},[r("el-input",{model:{value:e.addForm.username,callback:function(t){e.$set(e.addForm,"username",t)},expression:"addForm.username"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"昵称",prop:"nickname"}},[r("el-input",{model:{value:e.addForm.nickname,callback:function(t){e.$set(e.addForm,"nickname",t)},expression:"addForm.nickname"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{model:{value:e.addForm.email,callback:function(t){e.$set(e.addForm,"email",t)},expression:"addForm.email"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{model:{value:e.addForm.password,callback:function(t){e.$set(e.addForm,"password",t)},expression:"addForm.password"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{nativeOn:{click:function(t){e.addFormVisible=!1}}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{loading:e.addLoading,type:"primary"},nativeOn:{click:function(t){return e.addSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),r("el-dialog",{attrs:{visible:e.editFormVisible,"close-on-click-modal":!1,title:"编辑"},on:{"update:visible":function(t){e.editFormVisible=t}}},[r("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.editFormRules,"label-width":"80px"}},[r("el-input",{attrs:{type:"hidden"},model:{value:e.editForm.id,callback:function(t){e.$set(e.editForm,"id",t)},expression:"editForm.id"}}),e._v(" "),r("el-form-item",{attrs:{label:"用户名",prop:"username"}},[r("el-input",{model:{value:e.editForm.username,callback:function(t){e.$set(e.editForm,"username",t)},expression:"editForm.username"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"昵称",prop:"nickname"}},[r("el-input",{model:{value:e.editForm.nickname,callback:function(t){e.$set(e.editForm,"nickname",t)},expression:"editForm.nickname"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[r("el-input",{model:{value:e.editForm.email,callback:function(t){e.$set(e.editForm,"email",t)},expression:"editForm.email"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"角色",prop:"roles"}},[r("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"用户角色"},model:{value:e.editForm.roles,callback:function(t){e.$set(e.editForm,"roles",t)},expression:"editForm.roles"}},e._l(e.editForm.roles,(function(e){return r("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"密码",prop:"password"}},[r("el-input",{attrs:{placeholder:"不填写表示不更改密码"},model:{value:e.editForm.password,callback:function(t){e.$set(e.editForm,"password",t)},expression:"editForm.password"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"状态",prop:"status"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.editForm.status,callback:function(t){e.$set(e.editForm,"status",t)},expression:"editForm.status"}},[r("el-option",{key:0,attrs:{value:0,label:"正常"}}),e._v(" "),r("el-option",{key:1,attrs:{value:1,label:"删除"}})],1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{nativeOn:{click:function(t){e.editFormVisible=!1}}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{loading:e.editLoading,type:"primary"},nativeOn:{click:function(t){return e.editSubmit(t)}}},[e._v("提交")])],1)],1),e._v(" "),r("el-dialog",{attrs:{visible:e.forbiddenFormVisible,"close-on-click-modal":!1,title:"禁言"},on:{"update:visible":function(t){e.forbiddenFormVisible=t}}},[r("el-form",{ref:"forbiddenForm",attrs:{model:e.forbiddenForm,"label-width":"80px"}},[r("el-input",{attrs:{type:"hidden"},model:{value:e.forbiddenForm.userId,callback:function(t){e.$set(e.forbiddenForm,"userId",t)},expression:"forbiddenForm.userId"}}),e._v(" "),r("el-form-item",{attrs:{label:"禁言时间",prop:"reason"}},[r("el-select",{model:{value:e.forbiddenForm.days,callback:function(t){e.$set(e.forbiddenForm,"days",t)},expression:"forbiddenForm.days"}},[r("el-option",{attrs:{label:"3天",value:"3"}}),e._v(" "),r("el-option",{attrs:{label:"5天",value:"3"}}),e._v(" "),r("el-option",{attrs:{label:"7天",value:"7"}}),e._v(" "),r("el-option",{attrs:{label:"15天",value:"15"}}),e._v(" "),r("el-option",{attrs:{label:"30天",value:"30"}}),e._v(" "),r("el-option",{attrs:{label:"永久",value:"-1"}})],1)],1),e._v(" "),r("el-form-item",{attrs:{label:"禁言原因",prop:"reason"}},[r("el-select",{model:{value:e.forbiddenForm.reason,callback:function(t){e.$set(e.forbiddenForm,"reason",t)},expression:"forbiddenForm.reason"}},[r("el-option",{attrs:{value:"广告"}}),e._v(" "),r("el-option",{attrs:{value:"灌水"}}),e._v(" "),r("el-option",{attrs:{value:"涉黄"}}),e._v(" "),r("el-option",{attrs:{value:"涉政"}}),e._v(" "),r("el-option",{attrs:{value:"其他"}})],1)],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{nativeOn:{click:function(t){e.forbiddenFormVisible=!1}}},[e._v("取消")]),e._v(" "),r("el-button",{attrs:{loading:e.forbiddenLoading,type:"primary"},nativeOn:{click:function(t){return e.forbidden(t)}}},[e._v("禁言")])],1)],1)],1)}),[],!1,null,"86f43416",null);t.default=component.exports}}]);