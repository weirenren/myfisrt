(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{475:function(t,e,r){"use strict";r.r(e);r(22),r(23),r(8),r(15);var n=r(2),o=r(328),c=r(200),l=r(242),d=r(241),m={middleware:"authenticated",components:{TagInput:l.a,PostTweets:d.a},asyncData:function(t){return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.$axios,t.query,t.store;case 1:case"end":return e.stop()}}),e)})))()},data:function(){return{publishing:!1,captchaId:"",captchaUrl:"",captchaCode:"",imageList:[],postForm:{nodeId:2,title:"",tags:[],content:"",address:""}}},computed:{user:function(){return this.$store.state.user.current},config:function(){return this.$store.state.config.config}},mounted:function(){this.showCaptcha()},methods:{onImageUpload:function(t){this.imageList=t},submitCreate:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.publishing){e.next=2;break}return e.abrupt("return");case 2:if(t.postForm.title){e.next=5;break}return t.$toast.error("请输入标题"),e.abrupt("return");case 5:return t.publishing=!0,e.prev=6,r=o.a.homeItemToJsonString("北京",t.postForm.address),e.next=10,t.$axios.post("/api/topic/create",{city:c.a.getCity(),captchaId:t.captchaId,captchaCode:t.captchaCode,nodeId:t.postForm.nodeId,title:t.postForm.title,content:t.postForm.content,tags:t.postForm.tags?t.postForm.tags.join(","):"",imageList:t.imageList.toString(),extraData:JSON.stringify(r)});case 10:n=e.sent,t.$toast.success("提交成功",{duration:1e3,onComplete:function(){c.a.linkTo("/rent/"+n.topicId)}}),e.next=21;break;case 14:return e.prev=14,e.t0=e.catch(6),console.log(e.t0),e.next=19,t.showCaptcha();case 19:t.publishing=!1,t.$toast.error("提交失败："+(e.t0.message||e.t0));case 21:case"end":return e.stop()}}),e,null,[[6,14]])})))()},showCaptcha:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.config.topicCaptcha){e.next=12;break}return e.prev=1,e.next=4,t.$axios.get("/api/captcha/request",{params:{captchaId:t.captchaId||""}});case 4:r=e.sent,t.captchaId=r.captchaId,t.captchaUrl=r.captchaUrl,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),t.$toast.error(e.t0.message||e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))()},tweetsCreated:function(t){this.$refs.tweetsLoadMore.unshiftResults(t)}},head:function(){return{title:this.$siteTitle("租房")}}},v=r(49),component=Object(v.a)(m,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("section",{staticClass:"main"},[r("div",{staticClass:"container main-container is-white left-main"},[r("div",{staticClass:"left-container"},[r("div",{staticClass:"widget"},[r("div",{staticClass:"widget-header"},[r("nav",{staticClass:"breadcrumb"},[r("ul",[t._m(0),t._v(" "),r("li",[r("a",{attrs:{href:"/user/"+t.user.id+"?tab=topics"}},[t._v(t._s(t.user.nickname))])]),t._v(" "),t._m(1)])])]),t._v(" "),r("div",{staticClass:"widget-content"},[r("div",{staticClass:"field"},[r("label",{staticClass:"label"},[t._v("标题:")]),t._v(" "),r("div",{staticClass:"control"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.postForm.title,expression:"postForm.title"}],staticClass:"input",attrs:{type:"text",placeholder:"请输入租房标题"},domProps:{value:t.postForm.title},on:{input:function(e){e.target.composing||t.$set(t.postForm,"title",e.target.value)}}})])]),t._v(" "),r("div",{staticClass:"field"},[r("label",{staticClass:"label"},[t._v("详情:")]),t._v(" "),r("div",{staticClass:"control"},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:t.postForm.content,expression:"postForm.content"}],staticClass:"textarea is-large",attrs:{placeholder:"Large textarea"},domProps:{value:t.postForm.content},on:{input:function(e){e.target.composing||t.$set(t.postForm,"content",e.target.value)}}})])]),t._v(" "),r("div",{staticClass:"field"},[r("div",{staticClass:"control"},[r("post-tweets",{attrs:{"on-image-upload-call-back":t.onImageUpload}})],1)]),t._v(" "),r("div",{staticClass:"field"},[r("label",{staticClass:"label"},[t._v("地址:")]),t._v(" "),r("div",{staticClass:"control"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.postForm.address,expression:"postForm.address"}],staticClass:"input",attrs:{type:"text",placeholder:"西二旗地铁、回龙观"},domProps:{value:t.postForm.address},on:{input:function(e){e.target.composing||t.$set(t.postForm,"address",e.target.value)}}})])]),t._v(" "),r("div",{staticClass:"field"},[r("div",{staticClass:"control"},[r("tag-input",{model:{value:t.postForm.tags,callback:function(e){t.$set(t.postForm,"tags",e)},expression:"postForm.tags"}})],1)]),t._v(" "),t.captchaUrl?r("div",{staticClass:"field is-horizontal"},[r("div",{staticClass:"field control has-icons-left"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.captchaCode,expression:"captchaCode"}],staticClass:"input",staticStyle:{"max-width":"150px","margin-right":"20px"},attrs:{type:"text",placeholder:"验证码"},domProps:{value:t.captchaCode},on:{input:function(e){e.target.composing||(t.captchaCode=e.target.value)}}}),t._v(" "),t._m(2)]),t._v(" "),r("div",{staticClass:"field"},[r("a",{on:{click:t.showCaptcha}},[r("img",{staticStyle:{height:"40px"},attrs:{src:t.captchaUrl}})])])]):t._e(),t._v(" "),r("div",{staticClass:"field is-grouped"},[r("div",{staticClass:"control"},[r("a",{staticClass:"button is-success",class:{"is-loading":t.publishing},attrs:{disabled:t.publishing},on:{click:t.submitCreate}},[t._v("发表")])])])])])]),t._v(" "),r("div",{staticClass:"right-container"},[r("markdown-help")],1)])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("a",{attrs:{href:"/"}},[this._v("首页")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",{staticClass:"is-active"},[e("a",{attrs:{href:"#","aria-current":"page"}},[this._v("租房")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"icon is-small is-left"},[e("i",{staticClass:"iconfont icon-captcha"})])}],!1,null,"3660a717",null);e.default=component.exports}}]);