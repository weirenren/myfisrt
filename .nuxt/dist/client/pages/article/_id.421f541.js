(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{586:function(t,e,r){"use strict";r.r(e);r(17),r(9),r(30);var n=r(40),c=(r(16),r(2)),l=r(199),o=r(66),d={components:{Comment:r(257).a},asyncData:function(t){return Object(c.a)(regeneratorRuntime.mark((function e(){var r,c,l,article,o,d,m,v,h,f,_,y,C;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.$axios,c=t.params,l=t.error,e.prev=1,e.next=4,r.get("/api/article/"+c.id);case 4:article=e.sent,e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),l({statusCode:e.t0.errorCode,message:e.t0.message}),e.abrupt("return");case 11:return e.next=13,Promise.all([r.get("/api/comment/list",{params:{entityType:"article",entityId:article.articleId}}),r.get("/api/favorite/favorited",{params:{entityType:"article",entityId:c.id}}),r.get("/api/article/nearly/"+article.articleId),r.get("/api/article/related/"+article.articleId)]);case 13:return o=e.sent,d=Object(n.a)(o,4),m=d[0],v=d[1],h=d[2],f=d[3],_="",y=[],article.tags&&article.tags.length>0&&(article.tags.forEach((function(t){y.push(t.tagName)})),y.length>0&&(_=y.join(","))),C="",article.summary&&article.summary.length>0&&(C=article.summary.substr(0,128),article.summary.length>128&&(C+="...")),e.abrupt("return",{article:article,favorited:v.favorited,nearlyArticles:h,relatedArticles:f,commentsPage:m,keywords:_,description:C});case 25:case"end":return e.stop()}}),e,null,[[1,7]])})))()},computed:{hasPermission:function(){return this.isOwner||o.a.isOwner(this.user)||o.a.isAdmin(this.user)},isOwner:function(){return!(!this.user||!this.article)&&this.user.id===this.article.user.id},isPending:function(){return 2===this.article.status},user:function(){return this.$store.state.user.current}},methods:{deleteArticle:function(t){var e=this;return Object(c.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(window.confirm("是否确认删除该文章？")){r.next=2;break}return r.abrupt("return");case 2:return r.prev=2,r.next=5,e.$axios.post("/api/article/delete/"+t);case 5:e.$toast.success("删除成功！",{duration:1e3,onComplete:function(){l.a.linkTo("/articles")}}),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(2),e.$toast.error("删除失败："+(r.t0.message||r.t0));case 11:case"end":return r.stop()}}),r,null,[[2,8]])})))()},addFavorite:function(t){var e=this;return Object(c.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,!e.favorited){r.next=8;break}return r.next=4,e.$axios.get("/api/favorite/delete",{params:{entityType:"article",entityId:t}});case 4:e.favorited=!1,e.$toast.success("已取消收藏！"),r.next=12;break;case 8:return r.next=10,e.$axios.post("/api/article/favorite/"+t);case 10:e.favorited=!0,e.$toast.success("收藏成功！");case 12:r.next=18;break;case 14:r.prev=14,r.t0=r.catch(0),console.error(r.t0),e.$toast.error("收藏失败："+(r.t0.message||r.t0));case 18:case"end":return r.stop()}}),r,null,[[0,14]])})))()}},head:function(){return{title:this.$siteTitle(this.article.title),meta:[{hid:"description",name:"description",content:this.description},{hid:"keywords",name:"keywords",content:this.keywords}]}}},m=r(29),component=Object(m.a)(d,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("section",{staticClass:"main"},[r("div",{staticClass:"container main-container left-main size-320"},[r("div",{staticClass:"left-container"},[r("article",{staticClass:"article-item article-detail",attrs:{itemscope:"",itemtype:"http://schema.org/BlogPosting"}},[r("div",{staticClass:"main-content"},[r("div",{staticClass:"article-header"},[r("h1",{staticClass:"article-title",attrs:{itemprop:"headline"}},[t._v("\n              "+t._s(t.article.title)+"\n            ")]),t._v(" "),r("div",{staticClass:"article-meta"},[r("span",{staticClass:"article-meta-item"},[t._v("\n                由\n                "),r("a",{staticClass:"article-author",attrs:{href:"/user/"+t.article.user.id,itemprop:"author",itemscope:"",itemtype:"http://schema.org/Person"}},[r("span",{attrs:{itemprop:"name"}},[t._v(t._s(t.article.user.nickname))])]),t._v("发布于\n                "),r("time",{attrs:{datetime:t._f("formatDate")(t.article.createTime,"yyyy-MM-ddTHH:mm:ss"),itemprop:"datePublished"}},[t._v(t._s(t._f("prettyDate")(t.article.createTime)))])]),t._v(" "),t.article.tags&&t.article.tags.length>0?r("span",{staticClass:"article-meta-item"},t._l(t.article.tags,(function(e){return r("span",{key:e.tagId,staticClass:"article-tag tag"},[r("a",{attrs:{href:"/articles/"+e.tagId}},[t._v(t._s(e.tagName))])])})),0):t._e(),t._v(" "),r("div",{staticClass:"article-tool"},[t.hasPermission?r("span",[r("a",{on:{click:function(e){return t.deleteArticle(t.article.articleId)}}},[r("i",{staticClass:"iconfont icon-delete"}),t._v(" 删除\n                  ")])]):t._e(),t._v(" "),t.hasPermission?r("span",[r("a",{attrs:{href:"/article/edit/"+t.article.articleId}},[r("i",{staticClass:"iconfont icon-edit"}),t._v(" 修改\n                  ")])]):t._e(),t._v(" "),r("span",[r("a",{on:{click:function(e){return t.addFavorite(t.article.articleId)}}},[r("i",{staticClass:"iconfont icon-favorite"}),t._v(" "+t._s(t.favorited?"已收藏":"收藏")+"\n                  ")])]),t._v(" "),t.isPending?r("span",[t._m(0)]):t._e()])])]),t._v(" "),r("div",{staticClass:"ad"}),t._v(" "),r("div",{directives:[{name:"lazy-container",rawName:"v-lazy-container",value:{selector:"img"},expression:"{ selector: 'img' }"}],staticClass:"article-content content",attrs:{itemprop:"articleBody"},domProps:{innerHTML:t._s(t.article.content)}})]),t._v(" "),r("div",{staticClass:"ad"}),t._v(" "),r("comment",{attrs:{"entity-id":t.article.articleId,"comments-page":t.commentsPage,"show-ad":!0,"entity-type":"article"}})],1)]),t._v(" "),r("div",{staticClass:"right-container"},[t.relatedArticles&&t.relatedArticles.length?r("div",{staticClass:"widget no-margin"},[r("div",{staticClass:"widget-header"},[t._v("相关文章")]),t._v(" "),r("div",{staticClass:"widget-content article-related"},[r("ul",t._l(t.relatedArticles,(function(a){return r("li",{key:a.articleId},[r("a",{staticClass:"article-related-title",attrs:{href:"/article/"+a.articleId,title:a.title,target:"_blank"}},[t._v(t._s(a.title))])])})),0)])]):t._e(),t._v(" "),t.nearlyArticles&&t.nearlyArticles.length?r("div",{staticClass:"widget"},[r("div",{staticClass:"widget-header"},[t._v("近期文章")]),t._v(" "),r("div",{staticClass:"widget-content article-related"},[r("ul",t._l(t.nearlyArticles,(function(a){return r("li",{key:a.articleId},[r("a",{staticClass:"article-related-title",attrs:{href:"/article/"+a.articleId,title:a.title,target:"_blank"}},[t._v(t._s(a.title))])])})),0)])]):t._e()])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("a",{staticStyle:{cursor:"default","text-decoration":"none"},attrs:{href:"javascript:void(0)"}},[e("i",{staticClass:"iconfont icon-shenhe"}),this._v(" 审核中\n                  ")])}],!1,null,"3550928e",null);e.default=component.exports}}]);