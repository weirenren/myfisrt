(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{563:function(t,e,r){"use strict";r.r(e);r(18),r(16);var o=r(2),n=r(208),c=r(242),l=r(266),d=r(289),m={middleware:"authenticated",components:{TagInput:c.a,MarkdownHelp:l.a,MarkdownEditor:d.a},asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var r,o,n,c,l,d,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.$axios,o=t.query,n=t.store,e.next=3,r.get("/api/topic/nodes");case 3:if(c=e.sent,l=n.state.config.config||{},d=o.nodeId||l.defaultNodeId,m=null,!d){e.next=17;break}return e.prev=8,e.next=11,r.get("/api/topic/node?nodeId="+d);case 11:m=e.sent,e.next=17;break;case 14:e.prev=14,e.t0=e.catch(8),console.error(e.t0);case 17:return e.abrupt("return",{nodes:c,postForm:{nodeId:m?m.nodeId:0}});case 18:case"end":return e.stop()}}),e,null,[[8,14]])})))()},data:function(){return{publishing:!1,captchaId:"",captchaUrl:"",captchaCode:"",postForm:{nodeId:0,title:"",tags:[],content:"",extraData:"",jumphref:""}}},computed:{user:function(){return this.$store.state.user.current},config:function(){return this.$store.state.config.config}},mounted:function(){this.showCaptcha()},methods:{submitCreate:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.publishing){e.next=2;break}return e.abrupt("return");case 2:if(t.postForm.title){e.next=5;break}return t.$toast.error("请输入标题"),e.abrupt("return");case 5:if(t.postForm.nodeId){e.next=8;break}return t.$toast.error("请选择节点"),e.abrupt("return");case 8:return t.publishing=!0,e.prev=9,r={},o=t.getNodeName(t.postForm.nodeId),console.log(t.postForm.nodeId+" nodeName:"+o),"周末玩"===o?r=t.playFunParms():"今日热榜"===o&&(r=t.resoParms()),e.next=16,t.$axios.post("/api/topic/create",r);case 16:c=e.sent,t.$refs.mdEditor.clearCache(),t.$toast.success("提交成功",{duration:1e3,onComplete:function(){n.a.linkTo("/topic/"+c.topicId)}}),e.next=27;break;case 21:return e.prev=21,e.t0=e.catch(9),e.next=25,t.showCaptcha();case 25:t.publishing=!1,t.$toast.error("提交失败："+(e.t0.message||e.t0));case 27:case"end":return e.stop()}}),e,null,[[9,21]])})))()},getNodeName:function(t){var e="";return console.log("nodes:"+JSON.stringify(this.nodes)+" "+t),this.nodes.forEach((function(element){t===element.nodeId&&(e=element.name)})),e},playFunParms:function(){return{city:n.a.getCity(),captchaId:this.captchaId,captchaCode:this.captchaCode,nodeId:this.postForm.nodeId,title:this.postForm.title,content:this.postForm.content,tags:this.postForm.tags?this.postForm.tags.join(","):"",imageList:"",extraData:""}},resoParms:function(){var t={href:this.postForm.jumphref};return{city:n.a.getCity(),captchaId:this.captchaId,captchaCode:this.captchaCode,nodeId:this.postForm.nodeId,title:this.postForm.title,content:this.postForm.content,tags:this.postForm.tags?this.postForm.tags.join(","):"",imageList:"",extraData:JSON.stringify(t)}},showCaptcha:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.config.topicCaptcha){e.next=12;break}return e.prev=1,e.next=4,t.$axios.get("/api/captcha/request",{params:{captchaId:t.captchaId||""}});case 4:r=e.sent,t.captchaId=r.captchaId,t.captchaUrl=r.captchaUrl,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),t.$toast.error(e.t0.message||e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))()}},head:function(){return{title:this.$siteTitle("发表话题")}}},h=r(29),component=Object(h.a)(m,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("section",{staticClass:"main"},[r("div",{staticClass:"container main-container is-white left-main"},[r("div",{staticClass:"left-container"},[r("div",{staticClass:"widget"},[r("div",{staticClass:"widget-header"},[r("nav",{staticClass:"breadcrumb"},[r("ul",[t._m(0),t._v(" "),r("li",[r("a",{attrs:{href:"/user/"+t.user.id+"?tab=topics"}},[t._v(t._s(t.user.nickname))])]),t._v(" "),t._m(1)])])]),t._v(" "),r("div",{staticClass:"widget-content"},[r("div",{staticClass:"field is-horizontal"},[r("div",{staticClass:"field-body"},[r("div",{staticClass:"field",staticStyle:{width:"100%"}},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.postForm.title,expression:"postForm.title"}],staticClass:"input",attrs:{type:"text",placeholder:"请输入标题"},domProps:{value:t.postForm.title},on:{input:function(e){e.target.composing||t.$set(t.postForm,"title",e.target.value)}}})]),t._v(" "),r("div",{staticClass:"field"},[r("div",{staticClass:"select"},[r("select",{directives:[{name:"model",rawName:"v-model",value:t.postForm.nodeId,expression:"postForm.nodeId"}],on:{change:function(e){var r=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){return"_value"in t?t._value:t.value}));t.$set(t.postForm,"nodeId",e.target.multiple?r:r[0])}}},[r("option",{attrs:{value:"0"}},[t._v("选择节点")]),t._v(" "),t._l(t.nodes,(function(e){return r("option",{key:e.nodeId,domProps:{value:e.nodeId}},[t._v(t._s(e.name)+"\n                    ")])}))],2)])])])]),t._v(" "),r("div",{staticClass:"field"},[r("div",{staticClass:"control"},[r("markdown-editor",{ref:"mdEditor",attrs:{"editor-id":"topicCreateEditor",placeholder:"可空，将图片复制或拖入编辑器可上传"},model:{value:t.postForm.content,callback:function(e){t.$set(t.postForm,"content",e)},expression:"postForm.content"}})],1)]),t._v(" "),r("div",{staticClass:"field"},[r("div",{staticClass:"field",staticStyle:{width:"100%"}},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.postForm.jumphref,expression:"postForm.jumphref"}],staticClass:"input",attrs:{type:"text",placeholder:"输入网址链接"},domProps:{value:t.postForm.jumphref},on:{input:function(e){e.target.composing||t.$set(t.postForm,"jumphref",e.target.value)}}})])]),t._v(" "),r("div",{staticClass:"field"},[r("div",{staticClass:"field",staticStyle:{width:"100%"}},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.postForm.extraData,expression:"postForm.extraData"}],staticClass:"input",attrs:{type:"text",placeholder:"新闻热点类型：热、沸、新"},domProps:{value:t.postForm.extraData},on:{input:function(e){e.target.composing||t.$set(t.postForm,"extraData",e.target.value)}}})])]),t._v(" "),r("div",{staticClass:"field"},[r("div",{staticClass:"control"},[r("tag-input",{model:{value:t.postForm.tags,callback:function(e){t.$set(t.postForm,"tags",e)},expression:"postForm.tags"}})],1)]),t._v(" "),t.captchaUrl?r("div",{staticClass:"field is-horizontal"},[r("div",{staticClass:"field control has-icons-left"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.captchaCode,expression:"captchaCode"}],staticClass:"input",staticStyle:{"max-width":"150px","margin-right":"20px"},attrs:{type:"text",placeholder:"验证码"},domProps:{value:t.captchaCode},on:{input:function(e){e.target.composing||(t.captchaCode=e.target.value)}}}),t._v(" "),t._m(2)]),t._v(" "),r("div",{staticClass:"field"},[r("a",{on:{click:t.showCaptcha}},[r("img",{staticStyle:{height:"40px"},attrs:{src:t.captchaUrl}})])])]):t._e(),t._v(" "),r("div",{staticClass:"field is-grouped"},[r("div",{staticClass:"control"},[r("a",{staticClass:"button is-success",class:{"is-loading":t.publishing},attrs:{disabled:t.publishing},on:{click:t.submitCreate}},[t._v("发表话题")])])])])])]),t._v(" "),r("div",{staticClass:"right-container"},[r("markdown-help")],1)])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("a",{attrs:{href:"/"}},[this._v("首页")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",{staticClass:"is-active"},[e("a",{attrs:{href:"#","aria-current":"page"}},[this._v("主题")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("span",{staticClass:"icon is-small is-left"},[e("i",{staticClass:"iconfont icon-captcha"})])}],!1,null,"be8b851a",null);e.default=component.exports}}]);