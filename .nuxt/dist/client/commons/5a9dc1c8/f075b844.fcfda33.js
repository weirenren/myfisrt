/*! For license information please see ../../LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{208:function(t,e,n){"use strict";n(93),n(23),n(24),n(9);var r=n(91),o=n(92),c=n(211),l=n.n(c),m=function(){function t(){Object(r.a)(this,t)}return Object(o.a)(t,[{key:"getCity",value:function(){var t=l.a.get("city");return void 0!==t?t:"北京"}},{key:"setCity",value:function(t){return l.a.set("city",t)}},{key:"linkTo",value:function(path){window.location=path}},{key:"toSignin",value:function(t){t||(t=window.location.pathname),this.linkTo("/user/signin?ref="+encodeURIComponent(t))}},{key:"isSigninUrl",value:function(t){return"/user/signin"===t}},{key:"isArray",value:function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{key:"isDate",value:function(t){return"[object Date]"==={}.toString.call(t)&&"Invalid Date"!==t.toString()&&!isNaN(t)}},{key:"isElement",value:function(t){return!(!t||!t.nodeName||1!==t.nodeType)}},{key:"isFunction",value:function(t){return"[object Function]"===Object.prototype.toString.call(t)}},{key:"unique",value:function(t){return t.filter((function(t,e,n){return n.indexOf(t,0)===e}))}},{key:"isNumber",value:function(t){return"[object Number]"===Object.prototype.toString.call(t)&&isFinite(t)}},{key:"isObject",value:function(t){return"[object Object]"===Object.prototype.toString.call(t)}},{key:"isString",value:function(t){return"[object String]"===Object.prototype.toString.call(t)}},{key:"isBoolean",value:function(t){return"boolean"==typeof t}},{key:"getCityList",value:function(){return["北京","上海","深圳","武汉","杭州"]}},{key:"isEmpty",value:function(content){var t=content;if(""===t||void 0===t)return!0;return new RegExp("^[ ]+$").test(t)}},{key:"getTopText",value:function(t){return 1===t?"顶":2===t?"火":3===t?"精华":""}}]),t}();e.a=new m},211:function(t,e,n){var r,o;!function(c){if(void 0===(o="function"==typeof(r=c)?r.call(e,n,e,t):r)||(t.exports=o),!0,t.exports=c(),!!0){var l=window.Cookies,m=window.Cookies=c();m.noConflict=function(){return window.Cookies=l,m}}}((function(){function t(){for(var i=0,t={};i<arguments.length;i++){var e=arguments[i];for(var n in e)t[n]=e[n]}return t}function e(s){return s.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function o(){}function c(e,n,c){if("undefined"!=typeof document){"number"==typeof(c=t({path:"/"},o.defaults,c)).expires&&(c.expires=new Date(1*new Date+864e5*c.expires)),c.expires=c.expires?c.expires.toUTCString():"";try{var l=JSON.stringify(n);/^[\{\[]/.test(l)&&(n=l)}catch(t){}n=r.write?r.write(n,e):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var m="";for(var d in c)c[d]&&(m+="; "+d,!0!==c[d]&&(m+="="+c[d].split(";")[0]));return document.cookie=e+"="+n+m}}function l(t,n){if("undefined"!=typeof document){for(var o={},c=document.cookie?document.cookie.split("; "):[],i=0;i<c.length;i++){var l=c[i].split("="),m=l.slice(1).join("=");n||'"'!==m.charAt(0)||(m=m.slice(1,-1));try{var d=e(l[0]);if(m=(r.read||r)(m,d)||e(m),n)try{m=JSON.parse(m)}catch(t){}if(o[d]=m,t===d)break}catch(t){}}return t?o[t]:o}}return o.set=c,o.get=function(t){return l(t,!1)},o.getJSON=function(t){return l(t,!0)},o.remove=function(e,n){c(e,"",t(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}((function(){}))}))},221:function(t,e,n){},243:function(t,e,n){"use strict";var r=n(221);n.n(r).a},259:function(t,e,n){"use strict";n(16);var r=n(2),o=(n(137),{props:{url:{type:String,required:!0},params:{type:Object,default:function(){return{}}},initData:{type:Object,default:function(){return{results:[],page:""}}},tagId:{type:Number,required:!1,default:function(){return-1}}},data:function(){return{page:1,results:this.initData.results||[],hasMore:!0,loading:!1}},computed:{disabled:function(){return this.loading||!this.hasMore}},mounted:function(){this.loadMore()},methods:{loadMore:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,n=Object.assign(t.params||{},{page:t.page,tagId:t.tagId}),e.next=5,t.$axios.get(t.url,{params:n});case 5:r=e.sent,t.hasMore=t.checkNextPage(r.page),r.results&&r.results.length?r.results.forEach((function(e){t.results.push(e)})):t.hasMore=!1,e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),t.hasMore=!1,console.error(e.t0);case 14:return e.prev=14,t.loading=!1,e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,10,14,17]])})))()},unshiftResults:function(t){t&&this.results.unshift(t)},pushResults:function(t){t&&this.results.push(t)},checkNextPage:function(t){return!!(t&&t.total>t.limit&&t.total/t.limit>=this.page)&&(this.page++,!0)}}}),c=(n(243),n(29)),component=Object(c.a)(o,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"}],staticClass:"load-more",attrs:{"infinite-scroll-disabled":"disabled","infinite-scroll-distance":"10"}},[t._t("default",null,{results:t.results}),t._v(" "),t.loading?n("div",{staticClass:"load-more-loading"},[n("div",{staticClass:"loading-animation"}),t._v(" "),n("span",{staticClass:"load-more-text"},[t._v("加载中...")])]):t._e()],2)}),[],!1,null,"e767f9ac",null);e.a=component.exports},265:function(t,e,n){"use strict";n(137);var r=n(259),o=n(208),c={components:{LoadMore:r.a},data:function(){return{}},props:{entityType:{type:String,default:"",required:!0},entityId:{type:Number,default:0,required:!0},commentsPage:{type:Object,default:function(){return{}}},showAd:{type:Boolean,default:!1}},mount:function(){},computed:{user:function(){return this.$store.state.user.current},isLogin:function(){return null!=this.$store.state.user.current}},methods:{append:function(data){data&&this.$refs.commentsLoadMore.unshiftResults(data)},reply:function(t){this.isLogin||o.a.toSignin(),this.$emit("reply",t)},cancelReply:function(){this.quote=null}}},l=n(29),m=Object(l.a)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comments"},[t.commentsPage?n("load-more",{ref:"commentsLoadMore",attrs:{params:{entityType:t.entityType,entityId:t.entityId},url:"/api/comment/list"},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.results;return[n("ul",t._l(r,(function(e,r){return n("li",{key:e.commentId,staticClass:"comment",attrs:{index:r,itemprop:"comment",itemscope:"",itemtype:"http://schema.org/Comment"}},[n("div",{staticClass:"comment-avatar"},[n("img",{staticClass:"avatar",attrs:{src:e.user.smallAvatar}})]),t._v(" "),n("div",{staticClass:"comment-meta"},[n("span",{staticClass:"comment-nickname",attrs:{itemprop:"creator",itemscope:"",itemtype:"http://schema.org/Person"}},[n("a",{attrs:{href:"/user/"+e.user.id,itemprop:"name"}},[t._v("\n              "+t._s(e.user.nickname)+"\n            ")])]),t._v(" "),n("span",{staticClass:"comment-time"},[n("time",{attrs:{datetime:t._f("formatDate")(e.createTime,"yyyy-MM-ddTHH:mm:ss"),itemprop:"datePublished"}},[t._v(t._s(t._f("prettyDate")(e.createTime)))])]),t._v(" "),n("span",{staticClass:"comment-reply"},[n("a",{on:{click:function(n){return t.reply(e)}}},[t._v("回复")])])]),t._v(" "),n("div",{staticClass:"comment-content content"},[e.quote?n("blockquote",{staticClass:"comment-quote"},[n("div",{staticClass:"comment-quote-user"},[n("img",{staticClass:"avatar size-20",attrs:{src:e.quote.user.smallAvatar}}),t._v(" "),n("a",{staticClass:"quote-nickname"},[t._v(t._s(e.quote.user.nickname))]),t._v(" "),n("span",{staticClass:"quote-time"},[t._v("\n                "+t._s(t._f("prettyDate")(e.quote.createTime))+"\n              ")])]),t._v(" "),n("div",{directives:[{name:"lazy-container",rawName:"v-lazy-container",value:{selector:"img"},expression:"{ selector: 'img' }"}],attrs:{itemprop:"text"},domProps:{innerHTML:t._s(e.quote.content)}})]):t._e(),t._v(" "),n("p",{directives:[{name:"lazy-container",rawName:"v-lazy-container",value:{selector:"img"},expression:"{ selector: 'img' }"}],domProps:{innerHTML:t._s(e.content)}})])])})),0)]}}],null,!1,1505187036)}):t._e()],1)}),[],!1,null,"c959cf86",null).exports,d=(n(16),n(2)),f={components:{},props:{entityType:{type:String,default:"",required:!0},entityId:{type:Number,default:0,required:!0}},data:function(){return{content:"",sending:!1,quote:null}},computed:{btnName:function(){return this.sending?"正在发表...":"发表"},user:function(){return this.$store.state.user.current},isLogin:function(){return null!=this.$store.state.user.current}},methods:{create:function(){var t=this;return Object(d.a)(regeneratorRuntime.mark((function e(){var data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.content){e.next=3;break}return t.$toast.error("请输入评论内容"),e.abrupt("return");case 3:if(!t.sending){e.next=6;break}return console.log("正在发送中，请不要重复提交..."),e.abrupt("return");case 6:return t.sending=!0,e.prev=7,e.next=10,t.$axios.post("/api/comment/create",{entityType:t.entityType,entityId:t.entityId,content:t.content,quoteId:t.quote?t.quote.commentId:""});case 10:data=e.sent,t.$emit("created",data),t.content="",t.quote=null,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(7),console.error(e.t0),t.$toast.error("评论失败："+(e.t0.message||e.t0));case 20:return e.prev=20,t.sending=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[7,16,20,23]])})))()},reply:function(t){this.quote=t,this.$refs.commentEditor.scrollIntoView({block:"start",behavior:"smooth"})},cancelReply:function(){this.quote=null},toLogin:function(){o.a.toSignin()}}},v=Object(l.a)(f,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment-form"},[t.isLogin?n("div",{staticClass:"comment-create"},[n("div",{ref:"commentEditor",staticClass:"comment-input-wrapper"},[t.quote?n("div",{staticClass:"comment-quote-info"},[t._v("\n        回复：\n        "),n("label",{domProps:{textContent:t._s(t.quote.user.nickname)}}),t._v(" "),n("i",{staticClass:"iconfont icon-close",attrs:{alt:"取消回复"},on:{click:t.cancelReply}})]):t._e(),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"textarea is-large",attrs:{"editor-id":"createEditor",height:"200px",placeholder:"请发表你的观点..."},domProps:{value:t.content},on:{submit:t.create,input:function(e){e.target.composing||(t.content=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"comment-button-wrapper"},[n("span",[t._v("Ctrl or ⌘ + Enter")]),t._v(" "),n("button",{staticClass:"button is-small is-success",domProps:{textContent:t._s(t.btnName)},on:{click:t.create}})])]):n("div",{staticClass:"comment-not-login"},[n("div",{staticClass:"comment-login-div"},[t._v("\n      请\n      "),n("a",{staticStyle:{"font-weight":"700"},on:{click:t.toLogin}},[t._v("登录")]),t._v("后发表观点\n    ")])])])}),[],!1,null,"7e0a8a20",null).exports,y={components:{},props:{entityType:{type:String,default:"",required:!0},entityId:{type:Number,default:0,required:!0}},data:function(){return{content:"",sending:!1,quote:null}},computed:{btnName:function(){return this.sending?"正在发表...":"发表"},user:function(){return this.$store.state.user.current},isLogin:function(){return null!=this.$store.state.user.current}},methods:{create:function(){var t=this;return Object(d.a)(regeneratorRuntime.mark((function e(){var data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.content){e.next=3;break}return t.$toast.error("请输入评论内容"),e.abrupt("return");case 3:if(!t.sending){e.next=6;break}return console.log("正在发送中，请不要重复提交..."),e.abrupt("return");case 6:return t.sending=!0,e.prev=7,e.next=10,t.$axios.post("/api/comment/create",{contentType:"text",entityType:t.entityType,entityId:t.entityId,content:t.content,quoteId:t.quote?t.quote.commentId:""});case 10:data=e.sent,t.$emit("created",data),t.content="",t.quote=null,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(7),console.error(e.t0),t.$toast.error("评论失败："+(e.t0.message||e.t0));case 20:return e.prev=20,t.sending=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[7,16,20,23]])})))()},reply:function(t){this.quote=t,this.$refs.commentEditor.scrollIntoView({block:"start",behavior:"smooth"})},cancelReply:function(){this.quote=null},toLogin:function(){o.a.toSignin()}}},h={name:"Comment",components:{CommentList:m,CommentInput:v,CommentTextInput:Object(l.a)(y,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment-form"},[t.isLogin?n("div",{staticClass:"comment-create"},[n("div",{ref:"commentEditor",staticClass:"comment-input-wrapper"},[t.quote?n("div",{staticClass:"comment-quote-info"},[t._v("\n        回复：\n        "),n("label",{domProps:{textContent:t._s(t.quote.user.nickname)}}),t._v(" "),n("i",{staticClass:"iconfont icon-close",attrs:{alt:"取消回复"},on:{click:t.cancelReply}})]):t._e(),t._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],staticClass:"text-input",attrs:{placeholder:"请发表你的观点..."},domProps:{value:t.content},on:{keydown:[function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.ctrlKey?t.create(e):null},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:e.metaKey?t.create(e):null}],input:function(e){e.target.composing||(t.content=e.target.value)}}})]),t._v(" "),n("div",{staticClass:"comment-button-wrapper"},[n("span",[t._v("Ctrl or ⌘ + Enter")]),t._v(" "),n("button",{staticClass:"button is-small is-success",domProps:{textContent:t._s(t.btnName)},on:{click:t.create}})])]):n("div",{staticClass:"comment-not-login"},[n("div",{staticClass:"comment-login-div"},[t._v("\n      请\n      "),n("a",{staticStyle:{"font-weight":"700"},on:{click:t.toLogin}},[t._v("登录")]),t._v("后发表观点\n    ")])])])}),[],!1,null,"1de668c8",null).exports},props:{mode:{type:String,default:"markdown"},entityType:{type:String,default:"",required:!0},entityId:{type:Number,default:0,required:!0},commentsPage:{type:Object,default:function(){return{}}},showAd:{type:Boolean,default:!1}},methods:{commentCreated:function(data){this.$refs.list.append(data)},reply:function(t){this.$refs.input.reply(t)}}},C=Object(l.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",["markdown"===t.mode?n("comment-input",{ref:"input",attrs:{"entity-id":t.entityId,"entity-type":t.entityType},on:{created:t.commentCreated}}):n("comment-text-input",{ref:"input",attrs:{"entity-id":t.entityId,"entity-type":t.entityType},on:{created:t.commentCreated}}),t._v(" "),n("comment-list",{ref:"list",attrs:{"entity-id":t.entityId,"entity-type":t.entityType,"comments-page":t.commentsPage},on:{reply:t.reply}})],1)}),[],!1,null,null,null);e.a=C.exports}}]);